<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>RISE Center | Smart Engineering</title>

    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>

    <script>
      // --- DATA RUANGAN  ---
      // ==========================================
      // 1. DATABASE
      // ==========================================
      const roomData = {
        "Lab MULMED": {
          title: "Integrated Creative Studio",
          desc: "Laboratorium produksi konten digital berbasis industri. Dilengkapi ekosistem end-to-end untuk rendering grafis, broadcasting, dan desain antarmuka modern.",
          features: ["4K Broadcasting", "Motion Capture", "UI/UX Research"],
          capacity: "40 Workstations",
          facilities: ["Mac Studio M2", "Green Screen", "Audio Booth"],
          color: "#8b5cf6",
        },
        "Lab CSN": {
          title: "Network & Cybersecurity Hub",
          desc: "Pusat simulasi infrastruktur jaringan global. Fokus riset pada ketahanan siber (Cyber Resilience), Cloud Architecture, dan Network Forensics.",
          features: ["Cyber Defense", "Cloud Infra", "Ethical Hacking"],
          capacity: "35 Engineers",
          facilities: ["Cisco Data Rack", "Server Farm", "Cyber Range"],
          color: "#3b82f6",
        },
        "Lab GIT": {
          title: "Geospatial & Information Tech",
          desc: "Pusat riset teknologi spasial dan pemetaan digital. Fokus pada pengolahan data geografis, penginderaan jauh, dan analisis wilayah menggunakan drone & satelit.",
          features: ["GIS Mapping", "Spatial Analysis", "ArcGIS / QGIS"],
          capacity: "30 Analysts",
          facilities: ["High-Spec PC", "Drone Mapping", "GPS Geodetic"],
          color: "#ec4899",
        },
        "Lab SE": {
          title: "Software Engineering Foundry",
          desc: "Fasilitas pengembangan perangkat lunak skala enterprise. Menerapkan siklus SDLC modern dengan metodologi Agile, Scrum, dan DevOps Automation.",
          features: ["DevOps Pipeline", "Agile Mgmt", "Microservices"],
          capacity: "40 Engineers",
          facilities: ["Dual-Monitor Rig", "Local Cloud", "Scrum Board"],
          color: "#10b981",
        },
        "TU Lab": {
          title: "Laboratory Admin Center",
          desc: "Sentral pelayanan administratif laboratorium, manajemen aset digital, dan sistem penjadwalan terintegrasi.",
          features: ["Asset Mgmt", "Scheduling", "Academic Service"],
          capacity: "Staff Area",
          facilities: ["Service Desk", "Digital Archive"],
          color: "#f59e0b",
        },
        "Lab KERIS": {
          title: "Artificial Intelligence Center",
          desc: "Pusat riset kecerdasan buatan tingkat lanjut. Mengolah Big Data, Deep Learning, dan Computer Vision untuk solusi sistem cerdas.",
          features: ["Deep Learning", "Computer Vision", "Predictive AI"],
          capacity: "25 Researchers",
          facilities: ["NVIDIA A100 Cluster", "TensorFlow Env", "Data Server"],
          color: "#06b6d4",
        },
        "Lab Besar": {
          title: "Grand Auditorium",
          desc: "Venue multifungsi berkapasitas besar untuk konferensi teknologi, seminar hibrida, dan praktikum massal terpadu.",
          features: ["Tech Conference", "Mass Practicum", "Hackathon Venue"],
          capacity: "100+ Attendees",
          facilities: ["Laser Projector", "Hi-Fi Audio", "Modular Seats"],
          color: "#a855f7",
        },
        "R. Rapat": {
          title: "Executive Meeting Room",
          desc: "Ruang diskusi strategis untuk perencanaan proyek riset dan sidang tugas akhir, dilengkapi telekonferensi.",
          features: ["Thesis Defense", "Project Sprint", "Executive Meeting"],
          capacity: "20 Seats",
          facilities: ["Smart Board", "Video Conference"],
          color: "#64748b",
        },
        "IT Mart": {
          title: "IT Mart & Student Store",
          desc: "Pusat penyediaan kebutuhan teknis mahasiswa, merchandise resmi, dan logistik ringan untuk mendukung aktivitas perkuliahan.",
          features: ["Official Merch", "Student Supplies", "Tech Snacks"],
          capacity: "Public Area",
          facilities: ["Vending Machine", "Digital Payment", "Lounge Area"],
          color: "#ef4444",
        },
      };

      // ==========================================
      // 2. HITBOX COMPONENT
      // ==========================================
      AFRAME.registerComponent("click-handler", {
        init: function () {
          const el = this.el;
          el.addEventListener("mouseenter", () => {
            // Cek double protection: Hanya ubah cursor kalau kelasnya clickable
            if (el.classList.contains("clickable")) document.body.style.cursor = "pointer";
          });
          el.addEventListener("mouseleave", () => {
            document.body.style.cursor = "default";
          });
          el.addEventListener("click", () => {
            // SAFETY CHECK: Jangan jalankan kalau tidak punya class clickable
            if (!el.classList.contains("clickable")) return;

            el.setAttribute("animation", "property: material.opacity; from: 0.5; to: 0; dur: 300; easing: easeOutQuad");
            const roomKey = el.getAttribute("data-room");
            if (roomData[roomKey]) showRoomDetail(roomData[roomKey]);
          });
        },
      });
    </script>

    <style>
      /* ==========================================
         3. STYLING
         ========================================== */
      :root {
        --accent: #3b82f6;
        --dark: #0f172a;
      }
      body {
        margin: 0;
        font-family: "Inter", sans-serif;
        overflow: hidden;
      }
      video {
        z-index: -1 !important;
      }
      .a-canvas {
        z-index: 1 !important;
      }

      /* UI Elements */
      #landing-page {
        position: fixed;
        inset: 0;
        z-index: 999;
        background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white;
        transition: opacity 0.5s;
      }
      .brand {
        font-size: 2.5rem;
        font-weight: 800;
        letter-spacing: -1px;
        margin-bottom: 5px;
      }
      .tagline {
        opacity: 0.7;
        font-size: 1rem;
        margin-bottom: 30px;
      }
      .btn-start {
        padding: 15px 40px;
        border-radius: 50px;
        background: white;
        color: #0f172a;
        border: none;
        font-weight: bold;
        font-size: 1rem;
        cursor: pointer;
        transition: transform 0.2s;
      }
      .btn-start:active {
        transform: scale(0.95);
      }

      #controls-container {
        position: fixed;
        right: 20px;
        top: 50%;
        transform: translateY(-50%);
        display: none;
        flex-direction: column;
        gap: 12px;
        z-index: 800;
        transition: opacity 0.3s;
      }
      .btn-ctrl {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: rgba(0, 0, 0, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: white;
        font-weight: bold;
        backdrop-filter: blur(10px);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .btn-floor.active {
        background: var(--accent);
        border-color: white;
        box-shadow: 0 0 15px var(--accent);
      }

      #info-detail {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: rgba(15, 23, 42, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 24px 24px 0 0;
        z-index: 900;
        color: white;
        transform: translateY(105%);
        transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        max-height: 85vh;
        display: flex;
        flex-direction: column;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.6);
      }
      #info-detail.active {
        transform: translateY(0);
      }
      .panel-header {
        padding: 20px 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }
      .close-btn {
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: white;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        font-size: 1.2rem;
        cursor: pointer;
      }
      .panel-content {
        padding: 24px;
        overflow-y: auto;
      }
      h2 {
        margin: 0 0 5px 0;
        color: var(--accent);
        font-size: 1.5rem;
      }
      p {
        font-size: 0.95rem;
        line-height: 1.6;
        opacity: 0.9;
        margin-top: 0;
      }
      .meta-group {
        margin-top: 20px;
      }
      .label {
        font-size: 0.75rem;
        text-transform: uppercase;
        opacity: 0.5;
        font-weight: bold;
        margin-bottom: 8px;
        letter-spacing: 1px;
      }
      .tag {
        display: inline-block;
        padding: 4px 12px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        font-size: 0.8rem;
        margin: 0 6px 6px 0;
        border: 1px solid rgba(255, 255, 255, 0.05);
      }
      ul {
        padding-left: 20px;
        margin: 0;
        opacity: 0.9;
      }
      li {
        margin-bottom: 6px;
        font-size: 0.9rem;
      }

      #scan-overlay {
        position: fixed;
        inset: 0;
        z-index: 10;
        display: none;
        pointer-events: none;
      }
      .scan-box {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 260px;
        height: 260px;
        border: 3px solid var(--accent);
        border-radius: 20px;
        box-shadow: 0 0 0 100vmax rgba(0, 0, 0, 0.7);
        animation: breathe 2s infinite;
      }
      @keyframes breathe {
        0%,
        100% {
          transform: translate(-50%, -50%) scale(1);
          border-color: var(--accent);
        }
        50% {
          transform: translate(-50%, -50%) scale(1.05);
          border-color: white;
        }
      }
    </style>
  </head>

  <body>
    <div id="landing-page">
      <div class="brand">RISE CENTER</div>
      <div class="tagline">Research & Innovation in Smart Engineering</div>
      <button class="btn-start" onclick="startAR()">ENTER EXPERIENCE</button>
    </div>

    <div id="scan-overlay"><div class="scan-box"></div></div>

    <div id="controls-container">
      <button class="btn-ctrl btn-floor active" id="btn-L1" onclick="switchFloor(1)">L1</button>
      <button class="btn-ctrl btn-floor" id="btn-L2" onclick="switchFloor(2)">L2</button>
      <div style="height: 10px"></div>
      <button class="btn-ctrl" onclick="zoom(0.1)">+</button>
      <button class="btn-ctrl" onclick="zoom(-0.1)">−</button>
    </div>x

    <div id="info-detail">
      <div class="panel-header">
        <span class="label">Room Detail</span>
        <button class="close-btn" onclick="closePanel()">×</button>
      </div>
      <div class="panel-content">
        <h2 id="detail-title">Loading...</h2>
        <p id="detail-desc">...</p>
        <div class="meta-group">
          <div class="label">Capacity</div>
          <div id="detail-capacity">-</div>
        </div>
        <div class="meta-group">
          <div class="label">Key Features</div>
          <div id="features-list"></div>
        </div>
        <div class="meta-group">
          <div class="label">Facilities</div>
          <ul id="facilities-list"></ul>
        </div>
      </div>
    </div>

    <a-scene
      mindar-image="imageTargetSrc: ./assets/targets.mind; autoStart: false; uiScanning: no;"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
    >
      <a-camera position="0 0 0" look-controls="enabled: false" cursor="fuse: false; rayOrigin: mouse;" raycaster="near: 0.1; far: 10000; objects: .clickable"></a-camera>

      <a-entity mindar-image-target="targetIndex: 0" id="target">
        <a-entity id="map-root" scale="1 1 1">
          <a-entity id="floor1" visible="true" position="0 0 0.1">
            <a-plane color="#000" opacity="0.6" width="2.2" height="1.6" position="0 0 -0.01"></a-plane>
            <a-image src="./assets/gambar_denah_lt1.png" width="2" height="1.5"></a-image>

            <a-plane class="clickable" click-handler data-room="Lab MULMED" position="-0.65 0.45 0.01" width="0.6" height="0.5" material="opacity: 0; transparent: true"></a-plane>
            <a-plane class="clickable" click-handler data-room="Lab CSN" position="0.65 0.45 0.01" width="0.6" height="0.5" material="opacity: 0; transparent: true"></a-plane>
            <a-plane class="clickable" click-handler data-room="Lab GIT" position="-0.65 -0.4 0.01" width="0.6" height="0.5" material="opacity: 0; transparent: true"></a-plane>
          </a-entity>

          <a-entity id="floor2" visible="false" position="0 0 0.1" scale="0 0 0">
            <a-plane color="#000" opacity="0.6" width="2.2" height="1.6" position="0 0 -0.01"></a-plane>
            <a-image src="./assets/gambar_denah_lt2.png" width="2" height="1.5"></a-image>

            <a-plane class="clickable" click-handler data-room="Lab SE" position="-0.7 0.45 0.01" width="0.5" height="0.5" material="opacity: 0; transparent: true"></a-plane>
            <a-plane class="clickable" click-handler data-room="TU Lab" position="-0.1 0.45 0.01" width="0.3" height="0.3" material="opacity: 0; transparent: true"></a-plane>
            <a-plane class="clickable" click-handler data-room="Lab KERIS" position="0.65 0.45 0.01" width="0.6" height="0.5" material="opacity: 0; transparent: true"></a-plane>
            <a-plane class="clickable" click-handler data-room="Lab Besar" position="0.1 -0.4 0.01" width="0.7" height="0.5" material="opacity: 0; transparent: true"></a-plane>
            <a-plane class="clickable" click-handler data-room="IT Mart" position="0.7 -0.45 0.01" width="0.4" height="0.4" material="opacity: 0; transparent: true"></a-plane>
            <a-plane class="clickable" click-handler data-room="R. Rapat" position="-0.7 -0.4 0.01" width="0.5" height="0.5" material="opacity: 0; transparent: true"></a-plane>
          </a-entity>
        </a-entity>
      </a-entity>
    </a-scene>

    <script>
      // ==========================
      // LOGIC CONTROLLER (FIXED)
      // ==========================
      let scale = 1;
      let isPanelOpen = false;
      let isTargetTracked = false;

      const target = document.getElementById("target");
      const controls = document.getElementById("controls-container");
      const overlay = document.getElementById("scan-overlay");

      function startAR() {
        const sceneEl = document.querySelector("a-scene");
        const arSystem = sceneEl.systems["mindar-image-system"];
        if (!arSystem) {
          alert("Error: System AR belum siap. Refresh halaman.");
          return;
        }

        document.getElementById("landing-page").style.opacity = 0;
        setTimeout(() => {
          document.getElementById("landing-page").style.display = "none";
          overlay.style.display = "block";
          arSystem.start();
        }, 500);
      }

      target.addEventListener("targetFound", () => {
        isTargetTracked = true;
        overlay.style.display = "none";
        if (!isPanelOpen) controls.style.display = "flex";
      });

      target.addEventListener("targetLost", () => {
        isTargetTracked = false;
        overlay.style.display = "block";
        controls.style.display = "none";
      });

      function showRoomDetail(data) {
        isPanelOpen = true;
        document.getElementById("detail-title").innerText = data.title;
        document.getElementById("detail-desc").innerText = data.desc;
        document.getElementById("detail-capacity").innerText = data.capacity;
        document.getElementById("features-list").innerHTML = data.features.map((f) => `<span class="tag">${f}</span>`).join("");
        document.getElementById("facilities-list").innerHTML = data.facilities.map((f) => `<li>${f}</li>`).join("");

        const panel = document.getElementById("info-detail");
        panel.style.setProperty("--accent", data.color);
        panel.classList.add("active");
        controls.style.display = "none";
      }

      function closePanel() {
        isPanelOpen = false;
        document.getElementById("info-detail").classList.remove("active");
        if (isTargetTracked) controls.style.display = "flex";
      }

      function zoom(d) {
        scale += d;
        scale = Math.min(Math.max(0.5, scale), 3);
        document.getElementById("map-root").setAttribute("scale", `${scale} ${scale} ${scale}`);
      }

      // ------------------------------------------------------------------
      // ANTI-GHOST CLICK LOGIC
      // Saat pindah lantai, kita set SCALE lantai yang mati jadi 0 0 0.
      // Ini membuat objeknya hilang total dari 'dunia' raycaster.
      // ------------------------------------------------------------------
      function switchFloor(n) {
        const f1 = document.getElementById("floor1");
        const f2 = document.getElementById("floor2");
        const b1 = document.getElementById("btn-L1");
        const b2 = document.getElementById("btn-L2");

        const toggleClickable = (entity, state) => {
          entity.querySelectorAll("a-plane").forEach((el) => {
            if (state) el.classList.add("clickable");
            else el.classList.remove("clickable");
          });
        };

        if (n === 1) {
          // AKTIFKAN L1
          f1.setAttribute("visible", true);
          f1.setAttribute("scale", "1 1 1"); // Kembalikan ukuran asli
          toggleClickable(f1, true); // Pasang class clickable

          // MATIKAN L2
          f2.setAttribute("visible", false);
          f2.setAttribute("scale", "0 0 0"); // HILANGKAN TOTAL
          toggleClickable(f2, false); // Cabut class clickable

          b1.classList.add("active");
          b2.classList.remove("active");
        } else {
          // AKTIFKAN L2
          f2.setAttribute("visible", true);
          f2.setAttribute("scale", "1 1 1"); // Kembalikan ukuran asli
          toggleClickable(f2, true);

          // MATIKAN L1
          f1.setAttribute("visible", false);
          f1.setAttribute("scale", "0 0 0"); // HILANGKAN TOTAL
          toggleClickable(f1, false);

          b2.classList.add("active");
          b1.classList.remove("active");
        }
      }
    </script>
  </body>
</html>
